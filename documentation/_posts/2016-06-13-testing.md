---
layout: documentation
title: Testing
---

Does it need its own page or can it reference writing your own?


-------------
Components and graphs can be loaded using the [ComponentLoader](@TODO:link)


Components can be defined and loaded in one file:

```coffeescript
  noflo = require 'noflo'

  fetchPeople = ->
    component = new noflo.Component
      inPorts:
        eh:
          datatype: 'all'
      outPorts:
        out:
          datatype: 'object'
          description: 'random data'
        error:
          datatype: 'object'
          description: 'if something goes horribly wrong'
      c.forwardBrackets
        eh: ['out', 'error']
      process: (input, output) ->
        eh = input.getData 'eh'
        output.send out: new noflo.IP 'openBracket'
        output.send out: eh
        output.send out: new noflo.IP 'closeBracket'

  log = ->
    component = new noflo.Component
      inPorts:
        in:
          type: 'all'
          description: 'data to log'
      outPorts:
        out:
          type: 'all'
          description: 'when finished'
    # we don't want to automatically forward from `in` so we set it to empty
    c.forwardBrackets = {}
    c.process (input, output) ->
      # the stream will contain all the forwarded openBrackets
      console.log input.getStream 'in'
      output.sendDone out: true

  loader = new noflo.ComponentLoader root
  loader.listComponents (err) ->
    return done err if err
    loader.registerComponent 'processapi', 'Log', log
    loader.registerComponent 'processapi', 'FetchPeople', fetchPeople
    done()

    fbpData = "
    INPORT=FetchPeople.EH:EH
    OUTPORT=Log.OUT:OUT
    FetchPeople(processapi/FetchPeople) OUT -> IN Log(processapi/Log)
    "
    noflo.graph.loadFBP fbpData, (err, g) ->
      return done err if err
      loader.registerComponent 'processapi', 'Connected', g
      loader.load 'processapi/Connected', (err, instance) ->
        return done err if err

        # instance of the graph we defined in `fbpData`
        c = instance

        # create and attach sockets
        eh = noflo.internalSocket.createSocket()
        out = noflo.internalSocket.createSocket()
        c.inPorts.eh.attach ins
        c.outPorts.out.attach out

        # will be openBracket, data, closeBracket
        # and those will be forwarded to Log `in` port
        # which will wrap the brackets that FetchPeople itself sends
        eh.send new noflo.IP 'openBracket'
        eh.send 'message'
        eh.send new noflo.IP 'closeBracket'

        out.on 'data', (data) ->
          console.log 'done'
          done()
```





------------

# if you want to run your tests on the browser builds using phantom

unless noflo.isBrowser()
  chai = require 'chai'
  path = require 'path'
  baseDir = path.resolve __dirname, '../'
else
  baseDir = 'canadianness'

# loading components vs graphs

loader = new noflo.ComponentLoader baseDir
loader.load 'canadianness/Canadianness', (err, instance) ->
  return done err if err
  c = instance

  # because it is a graph, we want to wait until it is ready
  c.once 'ready', ->
    c.start()
    # for asyncish
    setTimeout done, 1
